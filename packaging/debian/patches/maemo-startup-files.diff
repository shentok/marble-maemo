Index: src-fremantle/src/CMakeLists.txt
===================================================================
--- src-fremantle.orig/src/CMakeLists.txt	2012-08-12 12:53:12.000000000 +0200
+++ src-fremantle/src/CMakeLists.txt	2012-08-12 12:53:42.000000000 +0200
@@ -233,3 +233,12 @@
   ${CMAKE_CURRENT_SOURCE_DIR}/config-marble.h.cmake
   ${CMAKE_CURRENT_BINARY_DIR}/config-marble.h
 )
+
+install ( FILES marble.sh DESTINATION bin/ PERMISSIONS
+  OWNER_EXECUTE OWNER_WRITE OWNER_READ
+  GROUP_EXECUTE GROUP_READ
+  WORLD_READ WORLD_EXECUTE)
+install ( FILES marble.desktop DESTINATION
+  ${CMAKE_INSTALL_PREFIX}/../../usr/share/applications/hildon/ )
+install ( FILES marble.service DESTINATION
+  ${CMAKE_INSTALL_PREFIX}/../../usr/share/dbus-1/services/ )
Index: src-fremantle/src/marble.desktop
===================================================================
--- src-fremantle.orig/src/marble.desktop	2012-08-12 12:53:12.000000000 +0200
+++ src-fremantle/src/marble.desktop	2012-08-12 12:53:42.000000000 +0200
@@ -1,7 +1,6 @@
 [Desktop Entry]
 Type=Application
-TryExec=marble
-Exec=marble
+Exec=/opt/marble/bin/marble.sh
 Name=Marble
 Name[ast]=Marble
 Name[bg]=Marble
@@ -116,5 +115,9 @@
 GenericName[zh_TW]=桌面星象儀
 Icon=marble
 Terminal=false
-Categories=Qt;KDE;Education;Geography;
+StartupWMClass=marble
+X-Window-Icon=marble
 X-DocPath=marble/index.html
+X-HildonDesk-ShowInToolbar=true
+X-Osso-Service=org.kde.edu.marble
+X-Osso-Type=application/x-executable
Index: src-fremantle/src/marble.sh
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ src-fremantle/src/marble.sh	2012-08-12 12:53:42.000000000 +0200
@@ -0,0 +1,21 @@
+#!/bin/sh
+
+# Set the environment variable XDG_DATA_HOME to have
+# marble store cached data in /home/user/MyDocs/marble/data
+# Can be overridden by specifying an alternative path in
+# the environment variable MARBLE_DATA_HOME, e.g.
+# $ export MARBLE_DATA_HOME=/home/user
+# which would result in cached data being written to
+# /home/user/marble/data.
+XDG_DATA_HOME="${MARBLE_DATA_HOME:-${HOME}/MyDocs/.local/share}"
+export XDG_DATA_HOME
+
+# Marble is installed in /opt/marble. Add it's library
+# to the library search path.
+LD_LIBRARY_PATH="/opt/marble/lib:${LD_LIBRARY_PATH}"
+export LD_LIBRARY_PATH
+
+PATH="/opt/marble/bin:${PATH}"
+export PATH
+
+/opt/marble/bin/marble $*
Index: src-fremantle/src/marble.service
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ src-fremantle/src/marble.service	2012-08-12 12:53:42.000000000 +0200
@@ -0,0 +1,3 @@
+[D-BUS Service]
+Name=org.kde.edu.marble
+Exec=/opt/marble/bin/marble.sh
Index: src-fremantle/data/CMakeLists.txt
===================================================================
--- src-fremantle.orig/data/CMakeLists.txt	2012-08-12 12:53:12.000000000 +0200
+++ src-fremantle/data/CMakeLists.txt	2012-08-12 13:18:38.000000000 +0200
@@ -253,10 +253,10 @@
 endif(MOBILE)
 
 if(NOT APPLE AND NOT WIN32)
-  install (FILES icons/hi128-app-marble.png DESTINATION ${ICON_INSTALL_DIR}/hicolor/128x128/apps/ RENAME marble.png)
   install (FILES icons/hi64-app-marble.png DESTINATION ${ICON_INSTALL_DIR}/hicolor/64x64/apps/ RENAME marble.png)
   install (FILES icons/hi48-app-marble.png DESTINATION ${ICON_INSTALL_DIR}/hicolor/48x48/apps/ RENAME marble.png)
   install (FILES icons/hi32-app-marble.png DESTINATION ${ICON_INSTALL_DIR}/hicolor/32x32/apps/ RENAME marble.png)
+  install (FILES icons/hi32-app-marble.png DESTINATION ${ICON_INSTALL_DIR}/hicolor/26x26/apps/ RENAME marble.png)
   install (FILES icons/hi22-app-marble.png DESTINATION ${ICON_INSTALL_DIR}/hicolor/22x22/apps/ RENAME marble.png)
   install (FILES icons/hi16-app-marble.png DESTINATION ${ICON_INSTALL_DIR}/hicolor/16x16/apps/ RENAME marble.png)
 endif(NOT APPLE AND NOT WIN32 )
